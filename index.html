<!DOCTYPE html>
<html lang="fr" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LATYFA BOUTIQUE | Le Luxe √† Port√©e de Main</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,900&family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #c5a059;
            --dark: #121212;
            --accent: #ff6600;
            --soft-bg: #fdfdfd;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--soft-bg);
            color: var(--dark);
            overflow-x: hidden;
        }

        .logo-font { font-family: 'Playfair Display', serif; }

        /* SCROLLBAR CUSTOM */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        /* ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.5s ease forwards; }

        /* PRODUITS & CARTES */
        .product-card {
            background: white;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid #f0f0f0;
            position: relative;
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.08);
            border-color: var(--gold);
        }

        /* MODALES */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            z-index: 999;
            padding: 15px;
            overflow-y: auto;
        }
        .modal-overlay.active { display: flex; align-items: flex-start; justify-content: center; }
        .modal-content {
            background: white;
            width: 100%;
            max-width: 900px;
            border-radius: 20px;
            margin-top: 20px;
            position: relative;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* WHEEL */
        #wheel-canvas {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 8px solid white;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1);
        }

        /* TOAST */
        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--dark);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 800;
            z-index: 10000;
            transition: 0.5s;
        }
        #toast.show { transform: translateX(-50%) translateY(0); }

        /* BADGES */
        .badge-new { background: #000; color: #fff; padding: 4px 8px; font-size: 8px; font-weight: 900; position: absolute; top: 10px; right: 10px; z-index: 5; }
        .badge-promo { background: var(--accent); color: #fff; padding: 4px 8px; font-size: 8px; font-weight: 900; position: absolute; top: 10px; left: 10px; z-index: 5; }
    </style>
</head>
<body>

<div id="toast">Produit ajout√© ! üõçÔ∏è</div>

<div id="main-loader" class="fixed inset-0 bg-white z-[10000] flex flex-col items-center justify-center">
    <div class="relative">
        <div class="w-20 h-20 border-2 border-gray-100 rounded-full"></div>
        <div class="w-20 h-20 border-t-2 border-[var(--gold)] rounded-full animate-spin absolute top-0 left-0"></div>
    </div>
    <p class="mt-4 text-[10px] font-bold tracking-[0.5em] text-gray-400 uppercase">Latyfa Shop</p>
</div>

<header class="bg-white/90 backdrop-blur-md sticky top-0 z-[100] border-b border-gray-100">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
        <button onclick="toggleMenu()" class="text-xl lg:hidden"><i class="fa-solid fa-bars-staggered"></i></button>
        
        <div class="flex flex-col items-center cursor-pointer" onclick="window.scrollTo(0,0)">
            <h1 class="logo-font text-2xl lg:text-3xl font-black italic text-[var(--gold)]">LATYFA</h1>
            <span class="text-[8px] tracking-[0.4em] font-bold -mt-1">OFFICIAL STORE</span>
        </div>

        <div class="flex items-center gap-5">
            <div class="hidden lg:flex items-center gap-1 text-[var(--gold)] font-bold text-xs mr-4">
                <i class="fa-solid fa-circle text-[6px] animate-pulse"></i>
                <span id="visitor-count">1,248</span> VISITEURS
            </div>
            <button onclick="ouvrirAdmin()" class="text-gray-300 hover:text-black transition"><i class="fa-solid fa-user-shield"></i></button>
            <div class="relative cursor-pointer" onclick="ouvrirPanier()">
                <i class="fa-solid fa-bag-shopping text-xl"></i>
                <span id="cart-badge" class="absolute -top-2 -right-2 bg-[var(--accent)] text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">0</span>
            </div>
        </div>
    </div>
</header>

<div class="bg-white border-b border-gray-50 overflow-x-auto no-scrollbar">
    <div class="container mx-auto px-4 py-3 flex items-center gap-4">
        <div class="relative flex-1 min-w-[200px]">
            <input type="text" id="main-search" oninput="filtrerTout()" placeholder="Rechercher un bijou, un sac..." class="w-full bg-gray-100 border-none rounded-xl py-2 px-10 text-xs focus:ring-1 ring-[var(--gold)]">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
        </div>
        <div class="flex items-center gap-2 overflow-x-auto no-scrollbar pb-1">
            <button onclick="setCategory('tous')" class="cat-btn active bg-black text-white px-4 py-2 rounded-xl text-[10px] font-bold uppercase whitespace-nowrap">Tout</button>
            <button onclick="setCategory('bijoux')" class="cat-btn bg-white border px-4 py-2 rounded-xl text-[10px] font-bold uppercase whitespace-nowrap">Bijoux</button>
            <button onclick="setCategory('sac')" class="cat-btn bg-white border px-4 py-2 rounded-xl text-[10px] font-bold uppercase whitespace-nowrap">Sacs</button>
            <button onclick="setCategory('vetements')" class="cat-btn bg-white border px-4 py-2 rounded-xl text-[10px] font-bold uppercase whitespace-nowrap">V√™tements</button>
            <button onclick="setCategory('parfum')" class="cat-btn bg-white border px-4 py-2 rounded-xl text-[10px] font-bold uppercase whitespace-nowrap">Parfums</button>
        </div>
    </div>
</div>

<section class="relative h-[250px] lg:h-[450px] bg-black overflow-hidden">
    <img src="https://images.unsplash.com/photo-1549439602-43ebca2327af?w=1600" class="w-full h-full object-cover opacity-70 scale-105 hover:scale-100 transition duration-700">
    <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-6">
        <h2 class="text-white text-3xl lg:text-6xl font-black italic logo-font animate-fade">Collection Prestige</h2>
        <p class="text-[var(--gold)] font-bold text-xs lg:text-sm tracking-[0.3em] mt-2 uppercase">L'√©l√©gance n'est plus un luxe</p>
        <button class="mt-8 bg-white text-black px-10 py-4 rounded-full text-[10px] font-black uppercase tracking-widest hover:bg-[var(--gold)] hover:text-white transition">Voir les nouveaut√©s</button>
    </div>
</section>

<main class="container mx-auto px-4 py-12">
    <div class="flex justify-between items-end mb-8">
        <div>
            <h3 class="text-2xl font-black italic logo-font">Nos Articles</h3>
            <div class="h-1 w-12 bg-[var(--gold)] mt-1"></div>
        </div>
        <select id="sort-price" onchange="filtrerTout()" class="text-[10px] font-bold uppercase border-none bg-transparent outline-none cursor-pointer">
            <option value="default">Trier par</option>
            <option value="low">Prix croissant</option>
            <option value="high">Prix d√©croissant</option>
        </select>
    </div>

    <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 lg:gap-8">
        </div>
</main>

<section class="bg-[#121212] py-20 text-center text-white overflow-hidden relative">
    <div class="container mx-auto px-4 flex flex-col items-center">
        <h3 class="logo-font text-3xl font-black italic text-[var(--gold)] mb-2 uppercase">Gagnez un cadeau !</h3>
        <p class="text-gray-400 text-xs font-bold mb-10 tracking-widest">UNE SEULE TENTATIVE PAR CLIENT</p>
        
        <div class="relative p-4 bg-white/5 rounded-full border border-white/10">
            <canvas id="wheel-canvas" width="400" height="400"></canvas>
            <div class="absolute top-0 left-1/2 -translate-x-1/2 -mt-4 text-4xl text-[var(--gold)]">‚ñº</div>
        </div>
        
        <button id="spin-btn" onclick="lancerRoue()" class="mt-12 bg-[var(--gold)] text-white px-12 py-4 rounded-full font-black uppercase text-xs tracking-[0.2em] shadow-2xl hover:scale-105 transition">Tourner la roue</button>
    </div>
</section>

<div id="modal-detail" class="modal-overlay" onclick="fermerModales(event)">
    <div class="modal-content p-4 lg:p-8" onclick="event.stopPropagation()">
        <button onclick="fermerModales()" class="absolute top-4 right-6 text-2xl font-light">&times;</button>
        <div class="flex flex-col lg:flex-row gap-8 mt-4">
            <div class="lg:w-1/2">
                <div class="relative overflow-hidden rounded-2xl aspect-square bg-gray-50 border">
                    <img id="view-img-main" src="" class="w-full h-full object-cover">
                </div>
                <div id="view-thumbnails" class="flex gap-2 mt-4 overflow-x-auto pb-2"></div>
            </div>
            <div class="lg:w-1/2 flex flex-col">
                <span id="view-cat" class="text-[var(--gold)] text-[10px] font-black uppercase tracking-widest">Cat√©gorie</span>
                <h2 id="view-title" class="text-2xl lg:text-3xl font-black logo-font italic mt-2">Nom du produit</h2>
                <div class="flex items-center gap-4 mt-4">
                    <span id="view-price" class="text-2xl font-black text-[var(--accent)]">0 F</span>
                    <span id="view-old-price" class="text-gray-400 line-through text-sm font-bold"></span>
                </div>
                
                <div id="view-timer" class="hidden mt-4 bg-red-50 p-3 rounded-xl border border-red-100 flex items-center justify-between">
                    <span class="text-[10px] font-black text-red-600 uppercase">Fin de la promo :</span>
                    <span id="timer-display" class="font-mono font-bold text-red-600">00:00:00</span>
                </div>

                <div class="mt-6">
                    <h4 class="text-[10px] font-black uppercase text-gray-400 mb-2">Description</h4>
                    <p id="view-desc" class="text-sm text-gray-600 leading-relaxed"></p>
                </div>

                <div id="variants-area" class="mt-8 space-y-4">
                    <div id="size-box" class="hidden">
                        <label class="text-[10px] font-black uppercase">Taille disponible</label>
                        <div id="size-list" class="flex gap-2 mt-2"></div>
                    </div>
                </div>

                <div class="mt-auto pt-8 flex gap-4">
                    <div class="flex items-center border rounded-xl px-4">
                        <button onclick="changeQty(-1)" class="p-2 text-xl">-</button>
                        <input type="number" id="view-qty" value="1" class="w-12 text-center font-bold text-sm bg-transparent outline-none">
                        <button onclick="changeQty(1)" class="p-2 text-xl">+</button>
                    </div>
                    <button onclick="ajouterAuPanierFinal()" class="flex-1 bg-black text-white rounded-xl font-black uppercase text-xs tracking-widest flex items-center justify-center gap-3 py-4 shadow-xl hover:bg-[var(--gold)] transition">
                        <i class="fa-solid fa-cart-plus"></i> Ajouter au panier
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="modal-cart" class="modal-overlay" onclick="fermerModales(event)">
    <div class="modal-content max-w-md p-6" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black italic logo-font">Mon Panier</h2>
            <button onclick="fermerModales()" class="text-2xl">&times;</button>
        </div>
        
        <div id="cart-list" class="space-y-4 max-h-[400px] overflow-y-auto pr-2">
            </div>

        <div class="mt-8 pt-6 border-t space-y-3">
            <div class="flex justify-between text-xs font-bold uppercase">
                <span>Sous-total</span>
                <span id="cart-subtotal">0 F</span>
            </div>
            <div id="promo-line" class="hidden flex justify-between text-xs font-bold uppercase text-green-600">
                <span>Remise Gagn√©e</span>
                <span id="cart-discount">-0 F</span>
            </div>
            <div class="flex justify-between text-sm font-black uppercase text-[var(--accent)] pt-2 border-t border-dashed">
                <span>Total √† r√©gler</span>
                <span id="cart-total">0 F</span>
            </div>
        </div>

        <div class="mt-8 space-y-3">
            <input type="text" id="cust-name" placeholder="Votre nom complet" class="w-full bg-gray-50 border p-4 rounded-xl text-sm outline-none focus:ring-1 ring-[var(--gold)]">
            <select id="cust-zone" onchange="majTotalPanier()" class="w-full bg-gray-50 border p-4 rounded-xl text-sm outline-none">
                <option value="0">Choisir zone de livraison</option>
                <option value="1500">Abidjan - Zone Nord (1.500 F)</option>
                <option value="2000">Abidjan - Zone Sud (2.000 F)</option>
                <option value="3500">Int√©rieur du pays (3.500 F)</option>
                <option value="0">Retrait Boutique (Bouak√©)</option>
            </select>
            <button onclick="envoyerWhatsApp()" class="w-full bg-[#25D366] text-white py-4 rounded-xl font-black uppercase text-xs flex items-center justify-center gap-3 shadow-lg mt-4">
                <i class="fa-brands fa-whatsapp text-xl"></i> Confirmer sur WhatsApp
            </button>
        </div>
    </div>
</div>

<div id="modal-admin" class="modal-overlay" onclick="fermerModales(event)">
    <div class="modal-content max-w-4xl p-8" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-black uppercase italic logo-font text-[var(--gold)]">Latyfa Manager v3.0</h2>
            <div class="flex gap-2">
                <button onclick="exportJSON()" class="p-2 bg-blue-50 text-blue-600 rounded-lg text-[10px] font-bold uppercase">Export</button>
                <button onclick="fermerModales()" class="text-2xl">&times;</button>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 space-y-3">
                <h3 class="text-[10px] font-black uppercase text-gray-400 border-b pb-2 mb-4">Ajouter un produit</h3>
                <input type="text" id="adm-name" placeholder="Nom du produit" class="w-full border p-3 rounded-lg text-xs">
                <div class="flex gap-2">
                    <input type="number" id="adm-price" placeholder="Prix" class="w-1/2 border p-3 rounded-lg text-xs font-bold">
                    <input type="number" id="adm-old-price" placeholder="Prix Promo" class="w-1/2 border p-3 rounded-lg text-xs">
                </div>
                <select id="adm-cat" class="w-full border p-3 rounded-lg text-xs font-bold">
                    <option value="bijoux">Bijoux</option>
                    <option value="sac">Sacs</option>
                    <option value="vetements">V√™tements</option>
                    <option value="parfum">Parfums</option>
                </select>
                <textarea id="adm-imgs" placeholder="URLs des images (une par ligne)" class="w-full border p-3 rounded-lg text-xs h-24"></textarea>
                <textarea id="adm-desc" placeholder="Description courte" class="w-full border p-3 rounded-lg text-xs h-20"></textarea>
                
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                    <input type="checkbox" id="adm-new" class="w-4 h-4 accent-black">
                    <label class="text-[10px] font-bold uppercase">Marquer comme Nouveau</label>
                </div>

                <button onclick="saveProduct()" id="save-btn" class="w-full bg-black text-white py-4 rounded-xl font-black uppercase text-xs tracking-tighter shadow-lg">Mettre en boutique</button>
            </div>

            <div class="lg:col-span-2 space-y-6">
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-orange-50 p-4 rounded-2xl border border-orange-100">
                        <p class="text-[8px] font-black uppercase text-orange-400">Total Articles</p>
                        <p id="stat-total" class="text-xl font-black">0</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-2xl border border-green-100">
                        <p class="text-[8px] font-black uppercase text-green-400">En Promo</p>
                        <p id="stat-promo" class="text-xl font-black">0</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 text-blue-600">
                        <button onclick="toggleMaintenance()" class="text-[8px] font-black uppercase underline">Mode Maintenance</button>
                        <p id="status-mode" class="text-[9px] font-bold mt-1 text-black">OFFLINE : NON</p>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-2xl border h-[400px] overflow-y-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="text-[9px] font-black uppercase text-gray-400 border-b">
                                <th class="pb-2">Produit</th>
                                <th class="pb-2 text-center">Prix</th>
                                <th class="pb-2 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adm-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="bg-white border-t py-16">
    <div class="container mx-auto px-4 text-center">
        <h2 class="logo-font text-3xl font-black italic text-[var(--gold)] mb-6">LATYFA SHOP</h2>
        <div class="flex justify-center gap-8 mb-8">
            <a href="#" class="text-xl text-gray-400 hover:text-black transition"><i class="fa-brands fa-instagram"></i></a>
            <a href="#" class="text-xl text-gray-400 hover:text-black transition"><i class="fa-brands fa-facebook"></i></a>
            <a href="#" class="text-xl text-gray-400 hover:text-black transition"><i class="fa-brands fa-tiktok"></i></a>
        </div>
        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-[0.4em]">¬© 2026 Designed for Elegance</p>
    </div>
</footer>

<script>
    // --- 1. CONFIGURATION & DONN√âES ---
    let db = JSON.parse(localStorage.getItem('latyfa_v3_db')) || [
        {
            id: 1,
            name: "Parure Royale 24K",
            price: 45000,
            oldPrice: 65000,
            cat: "bijoux",
            imgs: ["https://images.unsplash.com/photo-1515562141207-7a18b5ce7142?w=800", "https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?w=800"],
            desc: "Un ensemble somptueux pour vos c√©r√©monies les plus prestigieuses.",
            isNew: true,
            timer: 86400,
            stock: 5
        },
        {
            id: 2,
            name: "Sac √† Main Signature",
            price: 35000,
            oldPrice: null,
            cat: "sac",
            imgs: ["https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=800"],
            desc: "Le classique ind√©modable de la maison Latyfa.",
            isNew: false,
            stock: 12
        }
    ];

    let cart = JSON.parse(localStorage.getItem('latyfa_cart')) || [];
    let currentCategory = 'tous';
    let editingId = null;
    let userDiscount = 0;

    // --- 2. INITIALISATION ---
    window.onload = () => {
        setTimeout(() => {
            document.getElementById('main-loader').style.opacity = '0';
            setTimeout(() => document.getElementById('main-loader').style.display = 'none', 500);
        }, 1200);

        initVisitorCount();
        renderProducts();
        renderWheel();
        updateCartBadge();
        checkMaintenance();
    };

    // --- 3. MOTEUR DE RENDU ---
    function renderProducts() {
        const grid = document.getElementById('product-grid');
        const search = document.getElementById('main-search').value.toLowerCase();
        const sort = document.getElementById('sort-price').value;

        let filtered = db.filter(p => {
            const matchesCat = currentCategory === 'tous' || p.cat === currentCategory;
            const matchesSearch = p.name.toLowerCase().includes(search);
            return matchesCat && matchesSearch;
        });

        if (sort === 'low') filtered.sort((a,b) => a.price - b.price);
        if (sort === 'high') filtered.sort((a,b) => b.price - a.price);

        grid.innerHTML = filtered.map(p => `
            <div class="product-card rounded-2xl p-3 animate-fade cursor-pointer" onclick="openDetail(${p.id})">
                ${p.isNew ? '<span class="badge-new">NEW</span>' : ''}
                ${p.oldPrice ? '<span class="badge-promo">PROMO</span>' : ''}
                <div class="relative aspect-square overflow-hidden rounded-xl mb-4 bg-gray-50">
                    <img src="${p.imgs[0]}" class="w-full h-full object-cover">
                </div>
                <h4 class="text-[10px] font-black uppercase text-gray-400 tracking-wider">${p.cat}</h4>
                <h3 class="font-bold text-xs lg:text-sm mt-1 truncate">${p.name}</h3>
                <div class="flex items-center gap-2 mt-2">
                    <span class="text-[var(--accent)] font-black text-sm">${p.price.toLocaleString()} F</span>
                    ${p.oldPrice ? `<span class="text-gray-300 line-through text-[10px]">${p.oldPrice.toLocaleString()} F</span>` : ''}
                </div>
                <div class="mt-4 flex justify-between items-center border-t pt-3">
                    <span class="text-[8px] font-black uppercase tracking-tighter text-gray-400">D√©tails</span>
                    <div class="w-6 h-6 rounded-full bg-black text-white flex items-center justify-center text-[10px]">
                        <i class="fa-solid fa-plus"></i>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // --- 4. GESTION DES MODALES ---
    function openDetail(id) {
        const p = db.find(x => x.id === id);
        const modal = document.getElementById('modal-detail');
        
        document.getElementById('view-img-main').src = p.imgs[0];
        document.getElementById('view-title').innerText = p.name;
        document.getElementById('view-cat').innerText = p.cat;
        document.getElementById('view-price').innerText = p.price.toLocaleString() + " F";
        document.getElementById('view-old-price').innerText = p.oldPrice ? p.oldPrice.toLocaleString() + " F" : "";
        document.getElementById('view-desc').innerText = p.desc || "Aucune description disponible pour le moment.";
        
        // Vignettes
        const thumbDiv = document.getElementById('view-thumbnails');
        thumbDiv.innerHTML = p.imgs.map(img => `
            <img src="${img}" onclick="document.getElementById('view-img-main').src='${img}'" class="w-16 h-16 object-cover rounded-lg border cursor-pointer hover:border-[var(--gold)]">
        `).join('');

        // Timer
        if(p.oldPrice) {
            document.getElementById('view-timer').classList.remove('hidden');
            startTimer(3600 * 5); // 5 heures factices
        } else {
            document.getElementById('view-timer').classList.add('hidden');
        }

        modal.dataset.currentId = id;
        modal.classList.add('active');
    }

    function fermerModales(e) {
        document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
    }

    // --- 5. PANIER ---
    function changeQty(d) {
        const input = document.getElementById('view-qty');
        let v = parseInt(input.value) + d;
        if(v < 1) v = 1;
        input.value = v;
    }

    function ajouterAuPanierFinal() {
        const modal = document.getElementById('modal-detail');
        const id = parseInt(modal.dataset.currentId);
        const p = db.find(x => x.id === id);
        const qty = parseInt(document.getElementById('view-qty').value);

        const existing = cart.find(item => item.id === id);
        if(existing) {
            existing.qty += qty;
        } else {
            cart.push({ ...p, qty: qty });
        }

        saveCart();
        showToast("L'article a rejoint votre panier !");
        fermerModales();
    }

    function ouvrirPanier() {
        const list = document.getElementById('cart-list');
        document.getElementById('modal-cart').classList.add('active');
        
        if(cart.length === 0) {
            list.innerHTML = `<div class="py-20 text-center"><i class="fa-solid fa-bag-shopping text-4xl text-gray-100 mb-4"></i><p class="text-xs font-bold text-gray-400">VOTRE PANIER EST VIDE</p></div>`;
            majTotalPanier();
            return;
        }

        list.innerHTML = cart.map((item, idx) => `
            <div class="flex items-center gap-4 bg-gray-50 p-3 rounded-2xl relative">
                <img src="${item.imgs[0]}" class="w-16 h-16 object-cover rounded-lg">
                <div class="flex-1">
                    <h4 class="text-[10px] font-black uppercase truncate w-32">${item.name}</h4>
                    <p class="text-xs font-bold text-[var(--accent)] mt-1">${item.price.toLocaleString()} F</p>
                    <div class="flex items-center gap-3 mt-2">
                        <button onclick="updateQtyPanier(${idx}, -1)" class="w-5 h-5 bg-white border rounded flex items-center justify-center text-[10px]">-</button>
                        <span class="text-[10px] font-black">${item.qty}</span>
                        <button onclick="updateQtyPanier(${idx}, 1)" class="w-5 h-5 bg-white border rounded flex items-center justify-center text-[10px]">+</button>
                    </div>
                </div>
                <button onclick="removeFromCart(${idx})" class="text-gray-300 hover:text-red-500 transition"><i class="fa-solid fa-trash-can"></i></button>
            </div>
        `).join('');
        
        majTotalPanier();
    }

    function updateQtyPanier(idx, d) {
        cart[idx].qty += d;
        if(cart[idx].qty < 1) return removeFromCart(idx);
        saveCart();
        ouvrirPanier();
    }

    function removeFromCart(idx) {
        cart.splice(idx, 1);
        saveCart();
        ouvrirPanier();
    }

    function majTotalPanier() {
        const sub = cart.reduce((total, item) => total + (item.price * item.qty), 0);
        const liv = parseInt(document.getElementById('cust-zone').value);
        const disc = sub * (userDiscount / 100);
        const total = sub - disc + liv;

        document.getElementById('cart-subtotal').innerText = sub.toLocaleString() + " F";
        if(userDiscount > 0) {
            document.getElementById('promo-line').classList.remove('hidden');
            document.getElementById('cart-discount').innerText = "-" + disc.toLocaleString() + " F";
        }
        document.getElementById('cart-total').innerText = total.toLocaleString() + " F";
    }

    function envoyerWhatsApp() {
        const name = document.getElementById('cust-name').value;
        const zone = document.getElementById('cust-zone').options[document.getElementById('cust-zone').selectedIndex].text;
        
        if(!name || cart.length === 0) return alert("Veuillez remplir votre nom et ajouter des articles.");

        let msg = `‚ú® *COMMANDE LATYFA SHOP* ‚ú®\n\n`;
        msg += `üë§ *CLIENT :* ${name}\n`;
        msg += `üìç *LIVRAISON :* ${zone}\n\n`;
        msg += `üõçÔ∏è *ARTICLES :*\n`;
        
        cart.forEach(i => {
            msg += `- ${i.name} (x${i.qty}) : ${(i.price * i.qty).toLocaleString()} F\n`;
        });

        const total = document.getElementById('cart-total').innerText;
        msg += `\nüí∞ *TOTAL FINAL : ${total}*`;

        window.open(`https://wa.me/2250709002881?text=${encodeURIComponent(msg)}`);
    }

    // --- 6. ADMIN ENGINE ---
    function ouvrirAdmin() {
        const pass = prompt("Code d'acc√®s :");
        if(pass === "225") {
            document.getElementById('modal-admin').classList.add('active');
            renderAdminTable();
        }
    }

    function saveProduct() {
        const name = document.getElementById('adm-name').value;
        const price = parseInt(document.getElementById('adm-price').value);
        const oldPrice = parseInt(document.getElementById('adm-old-price').value) || null;
        const cat = document.getElementById('adm-cat').value;
        const imgs = document.getElementById('adm-imgs').value.trim().split('\n');
        const desc = document.getElementById('adm-desc').value;
        const isNew = document.getElementById('adm-new').checked;

        if(!name || !price || !imgs[0]) return alert("Champs manquants !");

        const data = { id: editingId || Date.now(), name, price, oldPrice, cat, imgs, desc, isNew };

        if(editingId) {
            const idx = db.findIndex(x => x.id === editingId);
            db[idx] = data;
            editingId = null;
            document.getElementById('save-btn').innerText = "Mettre en boutique";
        } else {
            db.push(data);
        }

        saveDB();
        renderAdminTable();
        renderProducts();
        resetAdmForm();
    }

    function renderAdminTable() {
        const body = document.getElementById('adm-table-body');
        document.getElementById('stat-total').innerText = db.length;
        document.getElementById('stat-promo').innerText = db.filter(x => x.oldPrice).length;

        body.innerHTML = db.map(p => `
            <tr class="border-b text-[10px] hover:bg-white transition">
                <td class="py-3 flex items-center gap-2">
                    <img src="${p.imgs[0]}" class="w-8 h-8 rounded object-cover">
                    <span class="font-bold">${p.name}</span>
                </td>
                <td class="text-center font-black">${p.price.toLocaleString()} F</td>
                <td class="text-right space-x-2">
                    <button onclick="editP(${p.id})" class="text-blue-500"><i class="fa-solid fa-pen"></i></button>
                    <button onclick="deleteP(${p.id})" class="text-red-400"><i class="fa-solid fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
    }

    function editP(id) {
        const p = db.find(x => x.id === id);
        editingId = id;
        document.getElementById('adm-name').value = p.name;
        document.getElementById('adm-price').value = p.price;
        document.getElementById('adm-old-price').value = p.oldPrice || "";
        document.getElementById('adm-cat').value = p.cat;
        document.getElementById('adm-imgs').value = p.imgs.join('\n');
        document.getElementById('adm-desc').value = p.desc;
        document.getElementById('adm-new').checked = p.isNew;
        document.getElementById('save-btn').innerText = "Confirmer les modifications";
        document.getElementById('adm-name').focus();
    }

    function deleteP(id) {
        if(confirm("Supprimer d√©finitivement cet article ?")) {
            db = db.filter(x => x.id !== id);
            saveDB();
            renderAdminTable();
            renderProducts();
        }
    }

    // --- 7. ROUE DE LA FORTUNE ---
    const gains = ["REESSAYER", "-5% PROMO", "LIVRAISON", "REESSAYER", "-10% PROMO", "CADEAU SURPRISE", "REESSAYER", "-2% PROMO"];
    function renderWheel() {
        const canvas = document.getElementById('wheel-canvas');
        const ctx = canvas.getContext('2d');
        const arc = (2 * Math.PI) / gains.length;

        gains.forEach((g, i) => {
            ctx.beginPath();
            ctx.fillStyle = i % 2 === 0 ? "#1a1a1a" : "#c5a059";
            ctx.moveTo(200, 200);
            ctx.arc(200, 200, 190, i * arc, (i + 1) * arc);
            ctx.fill();

            ctx.save();
            ctx.fillStyle = "white";
            ctx.translate(200, 200);
            ctx.rotate(i * arc + arc / 2);
            ctx.font = "bold 10px Montserrat";
            ctx.fillText(g, 100, 5);
            ctx.restore();
        });
    }

    function lancerRoue() {
        if(localStorage.getItem('latyfa_played')) return alert("Vous avez d√©j√† tent√© votre chance aujourd'hui ! ‚ú®");
        
        const deg = 1800 + Math.random() * 2000;
        document.getElementById('wheel-canvas').style.transform = `rotate(${deg}deg)`;
        document.getElementById('spin-btn').disabled = true;

        setTimeout(() => {
            const actualDeg = deg % 360;
            const idx = Math.floor((360 - actualDeg) / (360 / gains.length));
            const gain = gains[idx];
            
            if(gain.includes("%")) {
                userDiscount = parseInt(gain.match(/\d+/)[0]);
                alert(`BRAVO ! Vous avez gagn√© ${userDiscount}% de remise imm√©diate !`);
            } else {
                alert(`RESULTAT : ${gain}`);
            }
            
            localStorage.setItem('latyfa_played', 'true');
        }, 5200);
    }

    // --- 8. UTILS & HELPERS ---
    function setCategory(c) {
        currentCategory = c;
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active', 'bg-black', 'text-white'));
        event.target.classList.add('active', 'bg-black', 'text-white');
        renderProducts();
    }

    function filtrerTout() { renderProducts(); }

    function saveDB() { localStorage.setItem('latyfa_v3_db', JSON.stringify(db)); }
    function saveCart() { 
        localStorage.setItem('latyfa_cart', JSON.stringify(cart)); 
        updateCartBadge();
    }

    function updateCartBadge() {
        const count = cart.reduce((a, b) => a + b.qty, 0);
        document.getElementById('cart-badge').innerText = count;
    }

    function showToast(m) {
        const t = document.getElementById('toast');
        t.innerText = m;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    function initVisitorCount() {
        let v = parseInt(localStorage.getItem('latyfa_v_count') || "2450");
        v += Math.floor(Math.random() * 5);
        localStorage.setItem('latyfa_v_count', v);
        document.getElementById('visitor-count').innerText = v.toLocaleString();
    }

    function startTimer(duration) {
        let timer = duration, hours, minutes, seconds;
        const display = document.getElementById('timer-display');
        const interval = setInterval(() => {
            hours = parseInt(timer / 3600, 10);
            minutes = parseInt((timer % 3600) / 60, 10);
            seconds = parseInt(timer % 60, 10);

            display.textContent = `${hours < 10 ? "0"+hours : hours}:${minutes < 10 ? "0"+minutes : minutes}:${seconds < 10 ? "0"+seconds : seconds}`;

            if (--timer < 0) clearInterval(interval);
        }, 1000);
    }

    function resetAdmForm() {
        document.getElementById('adm-name').value = "";
        document.getElementById('adm-price').value = "";
        document.getElementById('adm-old-price').value = "";
        document.getElementById('adm-imgs').value = "";
        document.getElementById('adm-desc').value = "";
        document.getElementById('adm-new').checked = false;
        editingId = null;
    }

    function checkMaintenance() {
        if(localStorage.getItem('latyfa_maint') === 'true') {
            document.body.innerHTML = `<div class="h-screen flex flex-col items-center justify-center bg-white p-10 text-center"><h1 class="logo-font text-4xl text-[var(--gold)]">LATYFA SHOP</h1><p class="mt-4 font-bold text-gray-400 uppercase tracking-widest text-xs">Mise √† jour du catalogue en cours...<br>Revenez dans quelques minutes.</p></div>`;
        }
    }

    function toggleMaintenance() {
        const s = localStorage.getItem('latyfa_maint') === 'true';
        localStorage.setItem('latyfa_maint', !s);
        location.reload();
    }

    function exportJSON() {
        const blob = new Blob([JSON.stringify(db)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "latyfa_backup.json";
        a.click();
    }
</script>
</body>
</html>
