<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LATYFA | Maison de Luxe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #ffffff; --txt: #1a1a1a; --gold: #c49a6c; }
        body.dark-mode { --bg: #0a0a0a; --txt: #ffffff; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--bg); color: var(--txt); transition: 0.3s; margin: 0; }
        .luxury { font-family: 'Playfair Display', serif; }
        .modal-layer { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 5000; overflow-y: auto; padding: 20px; }
        .modal-layer.active { display: block; }
        .product-card { border: 1px solid #f2f2f2; border-radius: 12px; overflow: hidden; }
        body.dark-mode .product-card { border: 1px solid #1a1a1a; background: #111; }
    </style>
</head>
<body>

    <div id="shop-view">
        <header class="p-4 border-b sticky top-0 bg-inherit z-50 flex justify-between items-center">
            <div class="flex items-center gap-2" onclick="checkAdmin()">
                <div class="w-8 h-8 bg-black rounded-full border border-[#c49a6c]"></div>
                <h1 class="luxury text-xl uppercase tracking-tighter">Latyfa</h1>
            </div>
            <div class="flex gap-4 items-center">
                <button onclick="toggleTheme()" class="text-xl">ðŸŒ™</button>
                <button onclick="ouvrirPanier()" class="text-[10px] font-bold uppercase border-b-2 border-[#c49a6c]">
                    Panier (<span id="cart-count">0</span>)
                </button>
            </div>
        </header>

        <div class="p-4">
            <input type="text" id="search" onkeyup="render()" placeholder="RECHERCHER..." class="w-full p-3 mb-4 rounded-full border text-[10px] outline-none dark:bg-zinc-900 dark:border-zinc-800">
            <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>
    </div>

    <div id="panierModal" class="modal-layer">
        <div class="flex justify-between items-center mb-8">
            <h2 class="luxury text-2xl uppercase">Panier</h2>
            <button onclick="fermerModals()" class="text-3xl">&times;</button>
        </div>
        <div id="panier-liste" class="space-y-4 mb-8"></div>
        <div id="form-zone" class="hidden space-y-4 border-t pt-6">
            <p class="text-right font-bold text-lg mb-4">Total: <span id="total-prix">0</span> F CFA</p>
            <input type="text" id="c-nom" placeholder="VOTRE NOM" class="w-full border p-4 rounded dark:bg-zinc-900">
            <input type="text" id="c-adr" placeholder="VOTRE VILLE" class="w-full border p-4 rounded dark:bg-zinc-900">
            <button onclick="valider()" class="w-full bg-green-600 text-white py-4 font-bold rounded-xl uppercase">Commander sur WhatsApp</button>
        </div>
    </div>

    <div id="succesModal" class="modal-layer flex flex-col items-center justify-center text-center">
        <h2 class="luxury text-3xl mb-4">MERCI !</h2>
        <p class="text-[10px] text-gray-500 mb-8 uppercase tracking-widest">Confirmez l'envoi sur WhatsApp</p>
        <button onclick="telechargerPDF()" class="w-full border-2 border-black dark:border-white p-4 mb-4 font-bold rounded-xl text-[10px]">TÃ‰LÃ‰CHARGER LE REÃ‡U PDF</button>
        <button onclick="location.reload()" class="underline text-[10px] uppercase">Retour Boutique</button>
    </div>

    <div id="adminModal" class="modal-layer">
        <div class="flex justify-between items-center mb-10">
            <h2 class="luxury text-2xl uppercase">Admin</h2>
            <button onclick="fermerModals()" class="text-3xl">&times;</button>
        </div>
        <div id="admin-content" class="space-y-4"></div>
    </div>

    <script>
        let produits = [
            { id: 1, nom: "Sac Croco Signature", prix: 45000, cat: "Sac", stock: 5, img: "https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=500" },
            { id: 2, nom: "Escarpins Gold", prix: 35000, cat: "Chaussures", stock: 3, img: "https://images.unsplash.com/photo-1535043934128-cf0b28d52f95?w=500" },
            { id: 3, nom: "Bijoux Royal", prix: 18000, cat: "Bijoux", stock: 10, img: "https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=500" }
        ];

        let panier = [];
        let orderData = {};

        function render() {
            const query = document.getElementById('search').value.toLowerCase();
            const grid = document.getElementById('grid');
            grid.innerHTML = produits.filter(p => p.nom.toLowerCase().includes(query)).map(p => `
                <div class="product-card flex flex-col p-2">
                    <img src="${p.img}" class="w-full aspect-[3/4] object-cover rounded-lg mb-2">
                    <h3 class="text-[9px] font-bold uppercase truncate">${p.nom}</h3>
                    <p class="text-[10px] font-bold text-[#c49a6c] mb-2">${p.prix.toLocaleString()} F</p>
                    <button onclick="ajouter(${p.id})" class="w-full bg-black text-white py-2 rounded text-[8px] font-bold uppercase">Ajouter</button>
                </div>
            `).join('');
        }

        function ajouter(id) {
            const p = produits.find(x => x.id === id);
            panier.push(p);
            document.getElementById('cart-count').innerText = panier.length;
        }

        function ouvrirPanier() {
            document.getElementById('panierModal').classList.add('active');
            const list = document.getElementById('panier-liste');
            const form = document.getElementById('form-zone');
            if(panier.length === 0) {
                list.innerHTML = "<p class='text-center py-10 opacity-50 uppercase text-[10px]'>Vide</p>";
                form.classList.add('hidden');
            } else {
                let total = 0;
                list.innerHTML = panier.map(it => { total += it.prix; return `<div class="flex justify-between text-xs border-b pb-2"><span>${it.nom}</span><b>${it.prix.toLocaleString()} F</b></div>`; }).join('');
                document.getElementById('total-prix').innerText = total.toLocaleString();
                form.classList.remove('hidden');
            }
        }

        function valider() {
            const nom = document.getElementById('c-nom').value;
            const adr = document.getElementById('c-adr').value;
            if(!nom || !adr) return alert("Infos manquantes");

            orderData = { id: "LAT-" + Math.floor(1000+Math.random()*9000), nom, adr, total: document.getElementById('total-prix').innerText, items: [...panier] };
            
            let msg = `âœ¨ COMMANDE ${orderData.id} âœ¨\nClient: ${nom}\nLieu: ${adr}\nTotal: ${orderData.total} F CFA`;
            window.open(`https://wa.me/2250709002881?text=${encodeURIComponent(msg)}`);

            fermerModals();
            document.getElementById('succesModal').classList.add('active');
        }

        function telechargerPDF() {
            // CrÃ©ation dynamique du contenu pour Ã©viter le bug d'affichage
            const worker = document.createElement('div');
            worker.style.padding = "40px";
            worker.style.color = "black";
            worker.innerHTML = `
                <center><h1>LATYFA SHOP</h1><hr><p>Commande: ${orderData.id}</p><p>Client: ${orderData.nom}</p></center>
                <div style="margin:20px 0">${orderData.items.map(i => `<p>${i.nom} - ${i.prix} F</p>`).join('')}</div>
                <hr><h2 style="text-align:right">TOTAL: ${orderData.total} F CFA</h2>
            `;
            html2pdf().from(worker).save(`Recu_${orderData.id}.pdf`);
        }

        function toggleTheme() { document.body.classList.toggle('dark-mode'); }
        function fermerModals() { document.querySelectorAll('.modal-layer').forEach(m => m.classList.remove('active')); }

        let clicks = 0;
        function checkAdmin() {
            clicks++;
            if(clicks === 3) { document.getElementById('adminModal').classList.add('active'); document.getElementById('admin-content').innerHTML = "<p class='text-xs uppercase'>Menu de gestion activÃ©.</p>"; clicks = 0; }
            setTimeout(() => clicks = 0, 2000);
        }

        render();
    </script>
</body>
</html>
