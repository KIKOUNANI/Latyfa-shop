<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LATYFA BOUTIQUE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --latyfa-gold: #c5a059; }
        body { font-family: 'Montserrat', sans-serif; background: #fcfcfc; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .product-card { background: white; border-radius: 12px; padding: 15px; margin: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .error-box { background: #fee; border: 1px solid #fcc; padding: 15px; border-radius: 8px; margin: 20px; }
    </style>
</head>
<body>
    <header class="bg-white shadow-sm p-4">
        <div class="container mx-auto">
            <span class="text-2xl font-black italic text-[#c5a059]">LATYFA SHOP</span>
        </div>
    </header>

    <div class="container">
        <div id="error-display" class="error-box hidden">
            <h3 class="font-bold text-red-600">üî¥ Erreur d√©tect√©e</h3>
            <p id="error-message" class="text-red-500"></p>
        </div>

        <div id="product-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <p class="text-gray-400">Chargement des produits...</p>
        </div>
    </div>

    <script>
        console.log('üöÄ D√©marrage...');
        
        const productGrid = document.getElementById('product-grid');
        const errorDisplay = document.getElementById('error-display');
        const errorMessage = document.getElementById('error-message');
        
        function showError(msg, error) {
            console.error('‚ùå', msg, error);
            errorDisplay.classList.remove('hidden');
            errorMessage.innerHTML = `${msg}<br><small class="text-xs">${error?.message || 'Erreur inconnue'}</small>`;
            productGrid.innerHTML = '<p class="text-red-500">‚õî Erreur de chargement. Voir d√©tails ci-dessus.</p>';
        }

        function getDefaultProducts() {
            return [
                { id: 1, name: "Sac Prestige Latyfa", price: 45000, images: ["https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=500"] },
                { id: 2, name: "Collier Perle Royale", price: 25000, images: ["https://images.unsplash.com/photo-1515562141207-7a18b5ce7142?w=500"] },
                { id: 3, name: "Baya Cristal √âclat", price: 5000, images: ["https://images.unsplash.com/photo-1611085583191-a3b130944362?w=500"] }
            ];
        }

        function renderProducts(products) {
            if (!products || products.length === 0) {
                productGrid.innerHTML = '<p class="text-gray-400">Aucun produit √† afficher</p>';
                return;
            }
            
            productGrid.innerHTML = products.map(p => `
                <div class="product-card">
                    <img src="${p.images?.[0] || 'https://via.placeholder.com/300'}" class="w-full h-48 object-cover rounded-lg mb-3">
                    <h3 class="font-bold">${p.name || 'Sans nom'}</h3>
                    <p class="text-[#c5a059] font-bold text-xl">${p.price?.toLocaleString() || '0'} F</p>
                </div>
            `).join('');
        }

        async function init() {
            try {
                // 1. Tester si Supabase est disponible
                if (typeof window.supabase === 'undefined') {
                    throw new Error('La biblioth√®que Supabase n\'est pas charg√©e');
                }
                console.log('‚úì Supabase JS charg√©');

                // 2. Initialiser Supabase
                const supabaseUrl = 'https://tckhslbqptjquflyfyhu.supabase.co';
                const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRja2hzbGJxcHRqcXVmbHlmeWh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0NjczMTEsImV4cCI6MjA4NzA0MzMxMX0.oONsuo8atmylhTNzE68NUJxm_u35jXx-xmorlnWld6w';
                
                const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
                console.log('‚úì Client Supabase cr√©√©');

                // 3. Tester la connexion
                const { data: testData, error: testError } = await supabase.from('products').select('count', { count: 'exact', head: true });
                
                if (testError) {
                    if (testError.code === '42P01') {
                        throw new Error('La table "products" n\'existe pas dans votre base Supabase');
                    } else if (testError.code === '42501') {
                        throw new Error('Permissions RLS : vous n\'avez pas acc√®s √† la table products');
                    } else {
                        throw testError;
                    }
                }
                
                console.log('‚úì Connexion Supabase OK, table products accessible');

                // 4. Charger les produits
                const { data: produits, error: produitsError } = await supabase
                    .from('products')
                    .select('*')
                    .limit(10);

                if (produitsError) throw produitsError;

                if (produits && produits.length > 0) {
                    console.log(`‚úì ${produits.length} produits charg√©s depuis Supabase`);
                    renderProducts(produits);
                } else {
                    console.log('‚ö†Ô∏è Aucun produit dans Supabase, utilisation des produits par d√©faut');
                    renderProducts(getDefaultProducts());
                }

            } catch (error) {
                showError('Erreur lors de l\'initialisation', error);
                console.error('D√©tails de l\'erreur:', error);
                
                // Fallback : afficher les produits par d√©faut en cas d'erreur
                renderProducts(getDefaultProducts());
            }
        }

        // Lancer l'initialisation
        init();
    </script>
</body>
</html>
