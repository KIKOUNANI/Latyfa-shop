<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LATYFA BOUTIQUE - Test 5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,900;1,900&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>
    <style>
        :root { 
            --latyfa-gold: #c5a059;   
            --latyfa-dark: #1a1a1a;   
            --latyfa-accent: #ff6600; 
        }
        
        body { 
            background-color: #fcfcfc; 
            font-family: 'Montserrat', sans-serif; 
            margin: 0; 
        }
        
        .logo-font { font-family: 'Playfair Display', serif; color: var(--latyfa-gold) !important; }
        
        .test-section {
            border: 2px solid var(--latyfa-gold);
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
        }
        
        .product-card { 
            background: white; 
            border-radius: 12px; 
            border: 1px solid #e5e7eb;
            padding: 12px;
            margin: 10px;
            width: 200px;
        }
        
        .status-success { color: #10b981; }
        .status-error { color: #ef4444; }
        .status-warning { color: #f59e0b; }
    </style>
</head>
<body>
    <div class="bg-[#1a1a1a] text-[#c5a059] text-center py-2.5 text-[10px] font-bold">
        TEST 5 - Supabase + Chargement des donn√©es
    </div>

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <span class="text-xl font-black italic logo-font">LATYFA SHOP</span>
        </div>
    </header>

    <!-- SECTION DE TEST -->
    <div class="test-section">
        <h2 class="text-xl font-bold text-[#c5a059] mb-4">‚úÖ √âTAPE 5 - SUPABASE</h2>
        
        <div class="mb-4 p-4 bg-gray-50 rounded">
            <h3 class="font-bold mb-2">üìä Statut du chargement :</h3>
            <div id="status" class="space-y-2 text-sm"></div>
        </div>

        <!-- Grille de produits -->
        <h3 class="font-bold mb-2">üõçÔ∏è Produits :</h3>
        <div id="product-grid" class="flex flex-wrap gap-4">
            <!-- Les produits appara√Ætront ici -->
        </div>
    </div>

    <script>
        console.log('üöÄ √âTAPE 5 - Chargement...');
        
        let statusDiv = document.getElementById('status');
        let productGrid = document.getElementById('product-grid');
        let products = [];
        
        function addStatus(message, type = 'info') {
            const color = {
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600',
                info: 'text-blue-600'
            }[type] || 'text-gray-600';
            
            statusDiv.innerHTML += `<p class="${color}">${message}</p>`;
        }

        // ==================== INITIALISATION SUPABASE ====================
        let supabase = null;
        try {
            addStatus('üîÑ Initialisation de Supabase...', 'info');
            
            const supabaseUrl = 'https://tckhslbqptjquflyfyhu.supabase.co';
            const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRja2hzbGJxcHRqcXVmbHlmeWh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0NjczMTEsImV4cCI6MjA4NzA0MzMxMX0.oONsuo8atmylhTNzE68NUJxm_u35jXx-xmorlnWld6w';
            
            if (typeof window.supabase !== 'undefined') {
                supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
                addStatus('‚úÖ Supabase initialis√© avec succ√®s', 'success');
            } else {
                addStatus('‚ùå Biblioth√®que Supabase non trouv√©e', 'error');
            }
        } catch (error) {
            addStatus(`‚ùå Erreur Supabase: ${error.message}`, 'error');
            console.error(error);
        }

        // ==================== FONCTIONS ====================
        function getDefaultProducts() {
            return [
                { id: 1, name: "Sac Prestige Latyfa", price: 45000, images: ["https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=200"] },
                { id: 2, name: "Collier Perle Royale", price: 25000, images: ["https://images.unsplash.com/photo-1515562141207-7a18b5ce7142?w=200"] },
                { id: 3, name: "Baya Cristal √âclat", price: 5000, images: ["https://images.unsplash.com/photo-1611085583191-a3b130944362?w=200"] }
            ];
        }

        function renderProducts(productsToShow) {
            if (!productGrid) return;
            
            if (!productsToShow || productsToShow.length === 0) {
                productGrid.innerHTML = '<p class="text-gray-400">Aucun produit √† afficher</p>';
                return;
            }
            
            productGrid.innerHTML = productsToShow.map(p => `
                <div class="product-card">
                    <img src="${p.images?.[0] || 'https://via.placeholder.com/200'}" class="w-full h-32 object-cover rounded mb-2">
                    <h3 class="font-bold text-sm">${p.name || 'Sans nom'}</h3>
                    <p class="text-[#c5a059] font-bold">${p.price?.toLocaleString() || '0'} F</p>
                </div>
            `).join('');
        }

        async function chargerDonnees() {
            addStatus('üîÑ Chargement des donn√©es...', 'info');
            
            try {
                if (supabase) {
                    addStatus('üì¶ Tentative de chargement depuis Supabase...', 'info');
                    
                    const { data, error } = await supabase
                        .from('products')
                        .select('*')
                        .limit(5);
                    
                    if (error) {
                        addStatus(`‚ùå Erreur Supabase: ${error.message}`, 'error');
                        throw error;
                    }
                    
                    if (data && data.length > 0) {
                        products = data;
                        addStatus(`‚úÖ ${data.length} produits charg√©s depuis Supabase`, 'success');
                        console.log('Produits Supabase:', data);
                    } else {
                        addStatus('üì¶ Aucun produit dans Supabase, utilisation des produits par d√©faut', 'warning');
                        products = getDefaultProducts();
                    }
                } else {
                    addStatus('üì¶ Supabase non disponible, utilisation des produits par d√©faut', 'warning');
                    products = getDefaultProducts();
                }
                
                renderProducts(products);
                addStatus(`‚úÖ ${products.length} produits affich√©s`, 'success');
                
            } catch (error) {
                addStatus(`‚ùå Erreur g√©n√©rale: ${error.message}`, 'error');
                console.error('Erreur compl√®te:', error);
                products = getDefaultProducts();
                renderProducts(products);
            }
        }

        // Lancement
        chargerDonnees();
    </script>
</body>
</html>
