<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LATYFA | Maison de Luxe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background: #fff; }
        .luxury { font-family: 'Playfair Display', serif; }
        .modal { display: none; position: fixed; inset: 0; background: white; z-index: 1000; overflow-y: auto; }
        .modal.active { display: block; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .category-btn { position: relative; color: #888; transition: 0.3s; }
        .category-btn.active { color: #c49a6c; font-weight: 600; }
        .category-btn.active::after { content: ''; position: absolute; width: 100%; height: 2px; bottom: -5px; left: 0; background: #c49a6c; }
    </style>
</head>
<body>

    <div class="bg-[#c49a6c] text-white text-[9px] py-2 text-center uppercase font-bold tracking-[0.2em] sticky top-0 z-[60]">
        ✨ -15% SUR TOUT DÈS 20 000 F CFA ✨
    </div>

    <header class="border-b sticky top-[26px] bg-white/95 z-50 px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <img src="https://i.ibb.co/v4m8fXp/1000167529.png" class="h-10 w-10 rounded-full border">
            <h1 class="luxury text-xl tracking-widest uppercase">Latyfa</h1>
        </div>
        <div class="flex items-center gap-4 text-[10px] font-bold uppercase">
            <button onclick="window.toggleCompte()">Compte</button>
            <button onclick="window.ouvrirPanier()">Panier (<span id="cart-count">0</span>)</button>
        </div>
    </header>

    <div class="px-6 py-4 bg-gray-50 border-b">
        <input type="text" id="search" onkeyup="window.rechercher()" placeholder="RECHERCHER..." class="w-full bg-white border rounded-full py-2 px-6 text-[10px] outline-none focus:border-[#c49a6c]">
    </div>

    <nav class="flex overflow-x-auto gap-8 px-6 py-4 justify-start md:justify-center border-b text-[10px] uppercase font-medium no-scrollbar">
        <button onclick="window.filtrer('Tous', event)" class="category-btn active whitespace-nowrap">Tous</button>
        <button onclick="window.filtrer('Bijoux', event)" class="category-btn whitespace-nowrap">Bijoux</button>
        <button onclick="window.filtrer('Sac', event)" class="category-btn whitespace-nowrap">Sacs</button>
        <button onclick="window.filtrer('Chaussures', event)" class="category-btn whitespace-nowrap">Chaussures</button>
        <button onclick="window.filtrer('Vêtements Femme', event)" class="category-btn whitespace-nowrap">Femme</button>
    </nav>

    <main class="p-6 grid grid-cols-2 md:grid-cols-4 gap-8" id="product-grid"></main>

    <div id="cartModal" class="modal px-6 py-10">
        <div class="flex justify-between items-center mb-10">
            <h2 class="luxury text-2xl uppercase">Mon Panier</h2>
            <button onclick="window.fermerPanier()" class="text-3xl">&times;</button>
        </div>
        
        <div id="cart-items" class="space-y-4 mb-8"></div>

        <div id="checkout-section" style="display:none">
            <div class="bg-gray-50 p-4 rounded mb-6 text-sm uppercase tracking-widest">
                <div class="flex justify-between mb-2"><span>Sous-total</span> <span id="subtotal">0</span> F</div>
                <div id="promo-row" class="flex justify-between text-green-600 font-bold hidden"><span>Remise (-15%)</span> -<span id="disc">0</span> F</div>
                <div class="flex justify-between font-bold border-t pt-2 text-lg"><span>Total</span> <span id="total">0</span> F</div>
            </div>

            <div class="space-y-4 mb-6">
                <input type="text" id="nom" placeholder="NOM COMPLET" class="w-full border-b p-3 text-sm outline-none">
                <input type="text" id="adresse" placeholder="ADRESSE DE LIVRAISON" class="w-full border-b p-3 text-sm outline-none">
            </div>

            <div class="grid grid-cols-2 gap-4 mb-6">
                <label class="border p-3 text-center rounded cursor-pointer">
                    <input type="radio" name="mode" value="LIVRAISON" checked onchange="window.toggleLivraison(true)">
                    <span class="block text-[9px] font-bold mt-1">LIVRAISON</span>
                </label>
                <label class="border p-3 text-center rounded cursor-pointer">
                    <input type="radio" name="mode" value="BOUTIQUE" onchange="window.toggleLivraison(false)">
                    <span class="block text-[9px] font-bold mt-1">BOUTIQUE</span>
                </label>
            </div>

            <div class="space-y-3 mb-8">
                <p class="text-[10px] font-bold text-gray-400">PAIEMENT</p>
                <label class="flex items-center gap-3 p-3 border rounded"><input type="radio" name="pay" value="WAVE" checked> <span class="text-sm">WAVE (Lien direct)</span></label>
                <label class="flex items-center gap-3 p-3 border rounded"><input type="radio" name="pay" value="CASH"> <span class="text-sm">CASH À LA LIVRAISON</span></label>
            </div>

            <button onclick="window.validerCommande()" class="w-full bg-black text-white py-4 text-xs font-bold uppercase tracking-widest">Confirmer la Commande</button>
        </div>
    </div>

    <div id="accountModal" class="modal px-6 py-20">
        <h2 class="luxury text-2xl text-center mb-8">ESPACE CLIENT</h2>
        <div id="auth" class="text-center">
            <input type="email" id="email" placeholder="EMAIL" class="w-full border-b p-3 mb-6 outline-none">
            <button onclick="window.connexion()" class="w-full bg-black text-white py-4 text-[10px] font-bold uppercase">Accéder</button>
        </div>
        <div id="profile" style="display:none" class="text-center space-y-6">
            <p id="user-display" class="font-bold"></p>
            <div id="history" class="bg-gray-50 p-4 text-left text-[10px] space-y-2"></div>
            <button onclick="window.deconnexion()" class="text-red-400 text-[10px] uppercase">Déconnexion</button>
        </div>
        <button onclick="window.toggleCompte()" class="w-full mt-10 text-gray-400 text-xs">Fermer</button>
    </div>

    <div style="display:none">
        <div id="receipt" style="padding: 40px; font-family: sans-serif;">
            <center><img src="https://i.ibb.co/v4m8fXp/1000167529.png" style="height:60px"><h1>LATYFA SHOP</h1></center>
            <div style="margin:20px 0; border-top:1px solid #eee; padding-top:20px;">
                <p>N° COMMANDE : <span id="r-id"></span></p>
                <p>CLIENT : <span id="r-nom"></span></p>
                <div id="r-items" style="margin:20px 0;"></div>
                <p style="text-align:right; font-weight:bold; font-size:20px;">TOTAL : <span id="r-total"></span> F</p>
            </div>
        </div>
    </div>

    <script>
        const produits = [
            { id: 1, cat: "Sac", nom: "Sac Croco Luxe", prix: 45000, desc: "Cuir véritable.", img: "https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=500" },
            { id: 2, cat: "Chaussures", nom: "Escarpins Gold", prix: 35000, desc: "Talon 10cm.", img: "https://images.unsplash.com/photo-1535043934128-cf0b28d52f95?w=500", sizes: [36,37,38,39,40] },
            { id: 3, cat: "Vêtements Femme", nom: "Robe Satin", prix: 28000, desc: "Soie légère.", img: "https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=500", sizes: ["S","M","L"] },
            { id: 4, cat: "Bijoux", nom: "Collier Perles", prix: 15000, desc: "Plaqué or.", img: "https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=500" }
        ];

        let panier = [];

        window.render = (items = produits) => {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            items.forEach(p => {
                let s = p.sizes ? `<select id="sz-${p.id}" class="w-full border p-2 mb-2 text-[10px] font-bold uppercase"><option value="">Taille</option>${p.sizes.map(x=>`<option value="${x}">${x}</option>`).join('')}</select>` : '';
                grid.innerHTML += `<div class="flex flex-col border p-2">
                    <img src="${p.img}" class="w-full aspect-[3/4] object-cover mb-3">
                    <h3 class="text-[10px] font-bold uppercase mb-1">${p.nom}</h3>
                    <p class="text-[9px] text-gray-400 mb-3 italic flex-grow">${p.desc}</p>
                    ${s}
                    <div class="flex justify-between items-center pt-2 border-t">
                        <span class="font-bold text-xs">${p.prix.toLocaleString()} F</span>
                        <button onclick="window.ajouter(${p.id})" class="text-[9px] font-bold border-b border-black">Ajouter</button>
                    </div>
                </div>`;
            });
        };

        window.ajouter = (id) => {
            const p = produits.find(x => x.id === id);
            let sz = "";
            if(p.sizes) {
                sz = document.getElementById(`sz-${id}`).value;
                if(!sz) return alert("Sélectionnez une taille");
            }
            panier.push({...p, sz});
            document.getElementById('cart-count').innerText = panier.length;
            confetti({ particleCount: 30, colors: ['#c49a6c'] });
        };

        window.ouvrirPanier = () => {
            document.getElementById('cartModal').classList.add('active');
            const list = document.getElementById('cart-items');
            if(panier.length === 0) {
                list.innerHTML = "<p class='text-center py-10 text-gray-400'>Panier vide</p>";
                document.getElementById('checkout-section').style.display = 'none';
            } else {
                list.innerHTML = '';
                let st = 0;
                panier.forEach((it, i) => {
                    st += it.prix;
                    list.innerHTML += `<div class="flex justify-between border-b pb-2 text-[10px]">
                        <div><p class="font-bold uppercase">${it.nom} ${it.sz ? `(${it.sz})`:''}</p><p>${it.prix.toLocaleString()} F</p></div>
                        <button onclick="window.retirer(${i})" class="text-red-500 font-bold">&times;</button>
                    </div>`;
                });
                let disc = st >= 20000 ? st * 0.15 : 0;
                document.getElementById('subtotal').innerText = st.toLocaleString();
                document.getElementById('disc').innerText = disc.toLocaleString();
                document.getElementById('total').innerText = (st - disc).toLocaleString();
                document.getElementById('promo-row').classList.toggle('hidden', disc === 0);
                document.getElementById('checkout-section').style.display = 'block';
            }
        };

        window.retirer = (i) => { panier.splice(i,1); document.getElementById('cart-count').innerText = panier.length; window.ouvrirPanier(); };
        window.fermerPanier = () => document.getElementById('cartModal').classList.remove('active');
        
        window.rechercher = () => {
            const q = document.getElementById('search').value.toLowerCase();
            window.render(produits.filter(p => p.nom.toLowerCase().includes(q) || p.cat.toLowerCase().includes(q)));
        };

        window.filtrer = (cat, e) => {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            e.currentTarget.classList.add('active');
            window.render(cat === 'Tous' ? produits : produits.filter(p => p.cat === cat));
        };

        window.validerCommande = async () => {
            const nom = document.getElementById('nom').value;
            if(!nom) return alert("Nom requis");
            const cid = "LAT-" + Math.random().toString(36).substr(2,4).toUpperCase();
            const total = document.getElementById('total').innerText;
            const pay = document.querySelector('input[name="pay"]:checked').value;

            document.getElementById('r-id').innerText = cid;
            document.getElementById('r-nom').innerText = nom;
            document.getElementById('r-total').innerText = total;
            document.getElementById('r-items').innerHTML = panier.map(it => `<p style="font-size:12px;">${it.nom} - ${it.prix} F</p>`).join('');

            await html2pdf().from(document.getElementById('receipt')).save(`Latyfa_${cid}.pdf`);
            
            // Historique
            const h = JSON.parse(localStorage.getItem('latyfa_h') || '[]');
            h.push({id: cid, date: new Date().toLocaleDateString(), t: total});
            localStorage.setItem('latyfa_h', JSON.stringify(h));

            if(pay === "WAVE") {
                window.location.href = "https://pay.wave.com/m/M_ci_C7lQKnUsMYT3/c/ci/";
            } else {
                window.open(`https://wa.me/2250709002881?text=Commande ${cid} par ${nom}`);
            }
        };

        window.toggleCompte = () => { 
            document.getElementById('accountModal').classList.toggle('active');
            window.verifierSession();
        };

        window.connexion = () => { 
            localStorage.setItem('latyfa_u', document.getElementById('email').value); 
            window.verifierSession(); 
        };

        window.verifierSession = () => {
            const u = localStorage.getItem('latyfa_u');
            const h = JSON.parse(localStorage.getItem('latyfa_h') || '[]');
            document.getElementById('auth').style.display = u ? 'none' : 'block';
            document.getElementById('profile').style.display = u ? 'block' : 'none';
            if(u) {
                document.getElementById('user-display').innerText = u;
                document.getElementById('history').innerHTML = h.map(x => `<p>${x.id} - ${x.date} - ${x.t} F</p>`).join('') || 'Aucune commande';
            }
        };

        window.deconnexion = () => { localStorage.removeItem('latyfa_u'); window.verifierSession(); };
        window.toggleLivraison = (isL) => {
            const a = document.getElementById('adresse');
            a.value = isL ? "" : "RETRAIT EN BOUTIQUE";
            a.disabled = !isL;
        };

        window.render();
    </script>
</body>
</html>
